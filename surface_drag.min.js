var w_arr,points,arr,drawed,parchanged,pointsize_arr,mouseymin,mousexmax,on_point,v_degree,v_degreep1,v_n,v_nplus1,v_U,v_container,v_degchanged,v_t_step,u_degree,u_degreep1,u_n,u_nplus1,u_U,u_container,u_degchanged,u_t_step,scp_arr,cam,zunit,FELB,puff_arr,sugar,szog1,szog2,drawcn,drawcp,drawkp,notPopup,dmx,dmy,shift_x,shift_y,shift_z;function nurbs_weight(e,t,i,n){arr.fill(0);for(var r=e+i;r>=e;--r)if(t>=n[r]){if(n[r]==n[r+1])return 0;arr[r-e]=1;break}var u=1;for(r=i;r>=1;--r){for(var h=0;h<r;++h){let i=e+h;0!=arr[h]&&(arr[h]=(t-n[i])/(n[i+u]-n[i])*arr[h]),0!=arr[h+1]&&(arr[h]+=(n[i+u+1]-t)/(n[i+u+1]-n[i+1])*arr[h+1])}++u}return arr[0]}function setup(){setAttributes("antialias",!0),u_degreep1=(u_degree=3)+1,u_nplus1=(u_n=6)+1,v_degreep1=(v_degree=3)+1,v_nplus1=(v_n=6)+1,w_arr=new Array(49).fill(1),pointsize_arr=new Array(49).fill(1),u_U=[0,1,2,3,4,5,6,7,8,9,10],v_U=[0,1,2,3,4,5,6,7,8,9,10],FELB=25,puff_arr=new Array(3*(FELB+1)),u_t_step=(u_U[u_nplus1]-u_U[u_degree])/FELB,v_t_step=(v_U[v_nplus1]-v_U[v_degree])/FELB;var e=document.getElementById("cvas");createCanvas(e.offsetWidth,e.offsetHeight-4,WEBGL).parent("cvas"),cam=createCamera(),addScreenPositionFunction(),mousexmax=windowWidth-document.getElementById("two").offsetWidth,mouseymin=document.getElementById("leiras").offsetHeight,zunit=.875*width/v_n,points=[.1*width,.42*height,3*zunit,.22*width,.22*height,3*zunit,.36*width,.32*height,3*zunit,.46*width,.7*height,3*zunit,.62*width,.83*height,3*zunit,.76*width,.66*height,3*zunit,.84*width,.42*height,3*zunit,.24*width,.6*height,2*zunit,.25*width,.8*height,2*zunit,.28*width,.17*height,2*zunit,.68*width,.44*height,2*zunit,.72*width,.48*height,2*zunit,.76*width,.12*height,2*zunit,.81*width,.63*height,2*zunit,.07*width,.92*height,1*zunit,.23*width,.52*height,1*zunit,.38*width,.76*height,1*zunit,.51*width,.78*height,1*zunit,.71*width,.85*height,1*zunit,.77*width,.42*height,1*zunit,.85*width,.87*height,1*zunit,.09*width,.23*height,0,.13*width,.16*height,0,.15*width,.77*height,0,.17*width,.88*height,0,.24*width,.27*height,0,.82*width,.34*height,0,.84*width,.51*height,0,.02*width,.56*height,-1*zunit,.07*width,.32*height,-1*zunit,.13*width,.85*height,-1*zunit,.17*width,.48*height,-1*zunit,.3*width,.18*height,-1*zunit,.64*width,.27*height,-1*zunit,.76*width,.79*height,-1*zunit,.01*width,.21*height,-2*zunit,.21*width,.17*height,-2*zunit,.26*width,.06*height,-2*zunit,.38*width,.87*height,-2*zunit,.51*width,.53*height,-2*zunit,.7*width,.62*height,-2*zunit,.71*width,.73*height,-2*zunit,.07*width,.31*height,-3*zunit,.19*width,.64*height,-3*zunit,.3*width,.11*height,-3*zunit,.41*width,.34*height,-3*zunit,.7*width,.94*height,-3*zunit,.85*width,.91*height,-3*zunit,.91*width,.42*height,-3*zunit],sugar=height/2*2/tan(60*PI/360),szog1=PI/6,szog2=PI/4,dmx=0,dmy=0,shift_x=0,shift_y=0,shift_z=0,arr=new Array(7).fill(0),drawcn=!0,drawcp=!0,drawkp=!0,notPopup=!0,on_point=-1,parchanged=!0,v_degchanged=!0,u_degchanged=!0,drawed=!1}function draw(){if(keyWatch(),!drawed){if(background(111),cam.setPosition(-sugar*sin(szog2)*cos(szog1),-sugar*sin(szog1),sugar*cos(szog1)*cos(szog2)),cam.lookAt(0,0,0),cam.move(shift_x,shift_y,shift_z),translate(-width/2,-height/2),drawcn){strokeWeight(4),stroke(0),noFill();for(var e=0;e<points.length;e+=21){beginShape();for(let t=e;t<e+21;t+=3)vertex(points[t],points[t+1],points[t+2]);endShape()}for(e=0;e<u_nplus1;++e){beginShape();for(let t=3*e;t<points.length;t+=21)vertex(points[t],points[t+1],points[t+2]);endShape()}}if(stroke(0),parchanged){u_t_step=(u_U[u_nplus1]-u_U[u_degree])/FELB,v_t_step=(v_U[v_nplus1]-v_U[v_degree])/FELB,u_degchanged&&(u_container=new Array((FELB+1)*u_degreep1),u_degchanged=!1);var t=u_U[u_nplus1]-u_t_step/2;let i=0;for(let n=u_U[u_degree];n<t;n+=u_t_step,++i){let t=0,r=0;for(e=u_n;;--e)if(n>=u_U[e]){r=e,t=e-u_degree;break}let u=0;for(e=t;e<=r;++e,++u)u_container[i*u_degreep1+u]=nurbs_weight(e,n,u_degree,u_U)}v_degchanged&&(v_container=new Array((FELB+1)*v_degreep1),v_degchanged=!1);t=v_U[v_nplus1]-v_t_step/2;i=0;for(let n=v_U[v_degree];n<t;n+=v_t_step,++i){let t=0,r=0;for(e=v_n;;--e)if(n>=v_U[e]){r=e,t=e-v_degree;break}let u=0;for(e=t;e<=r;++e,++u)v_container[i*v_degreep1+u]=nurbs_weight(e,n,v_degree,v_U)}parchanged=!1}fill(0,255,0),strokeWeight(2),pointLight(0,230,0,0,0,3*zunit),ambientMaterial(0,190,0);let i=0,n=u_U[u_nplus1]-u_t_step/2,r=v_U[v_nplus1]-v_t_step/2,u=0,h=v_U[v_degree],s=0,_=0;for(e=v_n;;--e)if(h>=v_U[e]){_=e,s=e-v_degree;break}let o=0;for(let t=u_U[u_degree];t<n;t+=u_t_step,++o){let n=0,r=0;for(e=u_n;;--e)if(t>=u_U[e]){r=e,n=e-u_degree;break}let h=0,d=0,a=0,g=0,p=0;for(let e=s;e<=_;++e,++p){let t=0;for(let i=n;i<=r;++i,++t){let n=v_container[u*v_degreep1+p]*u_container[o*u_degreep1+t]*w_arr[u_nplus1*e+i];g+=n,h+=n*points[3*(u_nplus1*e+i)],d+=n*points[3*(u_nplus1*e+i)+1],a+=n*points[3*(u_nplus1*e+i)+2]}}if(g>0){let e=1/g;puff_arr[3*o]=h*e,puff_arr[3*o+1]=d*e,puff_arr[3*o+2]=a*e}else++i}for(u=1,h=v_U[v_degree]+v_t_step;h<r;h+=v_t_step,++u){for(beginShape(TRIANGLE_STRIP),s=0,_=0,e=v_n;;--e)if(h>=v_U[e]){_=e,s=e-v_degree;break}o=0;for(let t=u_U[u_degree];t<n;t+=u_t_step,++o){vertex(puff_arr[3*o],puff_arr[3*o+1],puff_arr[3*o+2]);let n=0,r=0;for(e=u_n;;--e)if(t>=u_U[e]){r=e,n=e-u_degree;break}let h=0,d=0,a=0,g=0,p=0;for(let e=s;e<=_;++e,++p){let t=0;for(let i=n;i<=r;++i,++t){let n=v_container[u*v_degreep1+p]*u_container[o*u_degreep1+t]*w_arr[u_nplus1*e+i];g+=n,h+=n*points[3*(u_nplus1*e+i)],d+=n*points[3*(u_nplus1*e+i)+1],a+=n*points[3*(u_nplus1*e+i)+2]}}if(g>0){let e=1/g;vertex(h*e,d*e,a*e),puff_arr[3*o]=h*e,puff_arr[3*o+1]=d*e,puff_arr[3*o+2]=a*e}else++i}endShape()}if(drawkp)for(stroke(50,50,255),strokeWeight(10),h=v_degree;h<v_nplus1;++h)for(let e=u_degree;e<u_nplus1;++e){let t=0,i=0,n=0,r=0,u=0;for(let s=h-v_degree;s<=h;++s,++u){let u=0;for(let _=e-u_degree;_<=e;++_,++u){let u=nurbs_weight(s,v_U[h],v_degree,v_U)*nurbs_weight(_,u_U[e],u_degree,u_U)*w_arr[u_nplus1*s+_];r+=u,t+=u*points[3*(u_nplus1*s+_)],i+=u*points[3*(u_nplus1*s+_)+1],n+=u*points[3*(u_nplus1*s+_)+2]}}if(r>0){let e=1/r;point(t*e,i*e,n*e)}}if(drawcp){stroke(50,255,50),scp_arr=[];for(e=0;e<points.length;e+=3)if(0!=pointsize_arr[e/3]){strokeWeight(20*pointsize_arr[e/3]),point(points[e],points[e+1],points[e+2]);let t=screenPosition(points[e],points[e+1],points[e+2]);scp_arr.push(t.x+width/2,t.y+height/2)}}drawed=!0}}function distance(e,t,i,n){let r=e-i,u=t-n;return r*r+u*u}function mouseMoved(){if(mouseX<=mousexmax&&mouseY>mouseymin){let t=0;for(var e=0;e<points.length;e+=3,++t)if(distance(scp_arr[2*t],scp_arr[2*t+1],mouseX,mouseY)<=100){if(on_point!=e/3&&notPopup){on_point=e/3;let t=document.getElementById("myPopup");t.style.left=mouseX-t.offsetWidth/2+"px",t.style.top=mouseY+"px",t.classList.add("show"),notPopup=!1}break}}}function mousePressed(){if(mouseX<=mousexmax&&mouseY>mouseymin)if(mouseButton===LEFT)dmx=mouseX,dmy=mouseY;else if(mouseButton===RIGHT){let e=document.getElementById("myPopup");e.classList.contains("show")&&(e.classList.remove("show"),on_point=-1,notPopup=!0)}}function mouseDragged(){if(mouseX<=mousexmax&&mouseY>mouseymin&&mouseButton===LEFT){var e=mouseX-dmx,t=mouseY-dmy;e>0?(szog2+=e/width*PI,drawed=!1):e<0&&(szog2+=e/width*PI,drawed=!1),t>0?((szog1+=t/height*PI)<-PI/2&&(szog1=-PI/2),drawed=!1):t<0&&((szog1+=t/height*PI)>PI/2&&(szog1=PI/2),drawed=!1),dmx=mouseX,dmy=mouseY}}function mouseWheel(e){mouseX<=mousexmax&&mouseY>mouseymin&&notPopup&&(e.delta>0?(sugar*=1.1,drawed=!1):(sugar*=.9,drawed=!1))}function keyWatch(){keyIsDown(40)&&(shift_y+=10,drawed=!1),keyIsDown(38)&&(shift_y-=10,drawed=!1),keyIsDown(39)&&(shift_x+=10,drawed=!1),keyIsDown(37)&&(shift_x-=10,drawed=!1),keyIsDown(74)&&(shift_z+=10,drawed=!1),keyIsDown(70)&&(shift_z-=10,drawed=!1),keyIsDown(13)&&(shift_x=0,shift_y=0,shift_z=0,drawed=!1)}