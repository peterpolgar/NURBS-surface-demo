var w_arr,points,arr,drawed,parchanged,pointsize_arr,mouseymin,mousexmax,on_point,v_degree,v_degreep1,v_n,v_nplus1,v_U,v_container,v_degchanged,v_t_step,u_degree,u_degreep1,u_n,u_nplus1,u_U,u_container,u_degchanged,u_t_step,scp_arr,cam,zunit,FELB,puff_arr,sugar,szog1,szog2,drawcn,drawcp,drawkp;function nurbs_weight(e,t,i,r){arr.fill(0);for(var n=e+i;n>=e;--n)if(t>=r[n]){if(r[n]==r[n+1])return 0;arr[n-e]=1;break}var u=1;for(n=i;n>=1;--n){for(var h=0;h<n;++h){let i=e+h;0!=arr[h]&&(arr[h]=(t-r[i])/(r[i+u]-r[i])*arr[h]),0!=arr[h+1]&&(arr[h]+=(r[i+u+1]-t)/(r[i+u+1]-r[i+1])*arr[h+1])}++u}return arr[0]}function setup(){u_degreep1=(u_degree=3)+1,u_nplus1=(u_n=6)+1,v_degreep1=(v_degree=3)+1,v_nplus1=(v_n=6)+1,w_arr=new Array(49).fill(1),pointsize_arr=new Array(49).fill(1),u_U=[0,1,2,3,4,5,6,7,8,9,10],v_U=[0,1,2,3,4,5,6,7,8,9,10],FELB=25,puff_arr=new Array(3*(FELB+1)),u_t_step=(u_U[u_nplus1]-u_U[u_degree])/FELB,v_t_step=(v_U[v_nplus1]-v_U[v_degree])/FELB;var e=document.getElementById("cvas");createCanvas(e.offsetWidth,e.offsetHeight-4,WEBGL).parent("cvas"),cam=createCamera(),addScreenPositionFunction(),mousexmax=windowWidth-document.getElementById("two").offsetWidth,mouseymin=document.getElementById("leiras").offsetHeight,zunit=.875*width/v_n,points=[.1*width,.42*height,3*zunit,.22*width,.22*height,3*zunit,.36*width,.32*height,3*zunit,.46*width,.7*height,3*zunit,.62*width,.83*height,3*zunit,.76*width,.66*height,3*zunit,.84*width,.42*height,3*zunit,.24*width,.6*height,2*zunit,.25*width,.8*height,2*zunit,.28*width,.17*height,2*zunit,.68*width,.44*height,2*zunit,.72*width,.48*height,2*zunit,.76*width,.12*height,2*zunit,.81*width,.63*height,2*zunit,.07*width,.92*height,1*zunit,.23*width,.52*height,1*zunit,.38*width,.76*height,1*zunit,.51*width,.78*height,1*zunit,.71*width,.85*height,1*zunit,.77*width,.42*height,1*zunit,.85*width,.87*height,1*zunit,.09*width,.23*height,0,.13*width,.16*height,0,.15*width,.77*height,0,.17*width,.88*height,0,.24*width,.27*height,0,.82*width,.34*height,0,.84*width,.51*height,0,.02*width,.56*height,-1*zunit,.07*width,.32*height,-1*zunit,.13*width,.85*height,-1*zunit,.17*width,.48*height,-1*zunit,.3*width,.18*height,-1*zunit,.64*width,.27*height,-1*zunit,.76*width,.79*height,-1*zunit,.01*width,.21*height,-2*zunit,.21*width,.17*height,-2*zunit,.26*width,.06*height,-2*zunit,.38*width,.87*height,-2*zunit,.51*width,.53*height,-2*zunit,.7*width,.62*height,-2*zunit,.71*width,.73*height,-2*zunit,.07*width,.31*height,-3*zunit,.19*width,.64*height,-3*zunit,.3*width,.11*height,-3*zunit,.41*width,.34*height,-3*zunit,.7*width,.94*height,-3*zunit,.85*width,.91*height,-3*zunit,.91*width,.42*height,-3*zunit],sugar=height/2*2/tan(60*PI/360),szog1=PI/6,szog2=PI/4,arr=new Array(7).fill(0),drawcn=!0,drawcp=!0,drawkp=!0,on_point=-1,parchanged=!0,v_degchanged=!0,u_degchanged=!0,drawed=!1}function draw(){if(keyWatch(),!drawed){if(background(111),cam.setPosition(-sugar*sin(szog2)*cos(szog1),-sugar*sin(szog1),sugar*cos(szog1)*cos(szog2)),cam.lookAt(0,0,0),translate(-width/2,-height/2),drawcn){strokeWeight(4),stroke(0),noFill();for(var e=0;e<points.length;e+=21){beginShape();for(let t=e;t<e+21;t+=3)vertex(points[t],points[t+1],points[t+2]);endShape()}for(e=0;e<u_nplus1;++e){beginShape();for(let t=3*e;t<points.length;t+=21)vertex(points[t],points[t+1],points[t+2]);endShape()}}if(stroke(255,50,50),parchanged){u_t_step=(u_U[u_nplus1]-u_U[u_degree])/FELB,v_t_step=(v_U[v_nplus1]-v_U[v_degree])/FELB,u_degchanged&&(u_container=new Array((FELB+1)*u_degreep1),u_degchanged=!1);var t=u_U[u_nplus1]-u_t_step/2;let i=0;for(let r=u_U[u_degree];r<t;r+=u_t_step,++i){let t=0,n=0;for(e=u_n;;--e)if(r>=u_U[e]){n=e,t=e-u_degree;break}let u=0;for(e=t;e<=n;++e,++u)u_container[i*u_degreep1+u]=nurbs_weight(e,r,u_degree,u_U)}v_degchanged&&(v_container=new Array((FELB+1)*v_degreep1),v_degchanged=!1);t=v_U[v_nplus1]-v_t_step/2;i=0;for(let r=v_U[v_degree];r<t;r+=v_t_step,++i){let t=0,n=0;for(e=v_n;;--e)if(r>=v_U[e]){n=e,t=e-v_degree;break}let u=0;for(e=t;e<=n;++e,++u)v_container[i*v_degreep1+u]=nurbs_weight(e,r,v_degree,v_U)}parchanged=!1}fill(0,255,0),strokeWeight(2),ambientLight(60,60,60),pointLight(249,249,129,0,0,3*zunit),ambientMaterial(255);let i=0,r=u_U[u_nplus1]-u_t_step/2,n=v_U[v_nplus1]-v_t_step/2,u=0,h=v_U[v_degree],_=0,s=0;for(e=v_n;;--e)if(h>=v_U[e]){s=e,_=e-v_degree;break}let d=0;for(let t=u_U[u_degree];t<r;t+=u_t_step,++d){let r=0,n=0;for(e=u_n;;--e)if(t>=u_U[e]){n=e,r=e-u_degree;break}let h=0,o=0,g=0,a=0,p=0;for(let e=_;e<=s;++e,++p){let t=0;for(let i=r;i<=n;++i,++t){let r=v_container[u*v_degreep1+p]*u_container[d*u_degreep1+t]*w_arr[u_nplus1*e+i];a+=r,h+=r*points[3*(u_nplus1*e+i)],o+=r*points[3*(u_nplus1*e+i)+1],g+=r*points[3*(u_nplus1*e+i)+2]}}if(a>0){let e=1/a;puff_arr[3*d]=h*e,puff_arr[3*d+1]=o*e,puff_arr[3*d+2]=g*e}else++i}for(u=1,h=v_U[v_degree]+v_t_step;h<n;h+=v_t_step,++u){for(beginShape(TRIANGLE_STRIP),_=0,s=0,e=v_n;;--e)if(h>=v_U[e]){s=e,_=e-v_degree;break}d=0;for(let t=u_U[u_degree];t<r;t+=u_t_step,++d){vertex(puff_arr[3*d],puff_arr[3*d+1],puff_arr[3*d+2]);let r=0,n=0;for(e=u_n;;--e)if(t>=u_U[e]){n=e,r=e-u_degree;break}let h=0,o=0,g=0,a=0,p=0;for(let e=_;e<=s;++e,++p){let t=0;for(let i=r;i<=n;++i,++t){let r=v_container[u*v_degreep1+p]*u_container[d*u_degreep1+t]*w_arr[u_nplus1*e+i];a+=r,h+=r*points[3*(u_nplus1*e+i)],o+=r*points[3*(u_nplus1*e+i)+1],g+=r*points[3*(u_nplus1*e+i)+2]}}if(a>0){let e=1/a;vertex(h*e,o*e,g*e),puff_arr[3*d]=h*e,puff_arr[3*d+1]=o*e,puff_arr[3*d+2]=g*e}else++i}endShape()}if(drawkp)for(stroke(50,50,255),strokeWeight(10),h=v_degree;h<v_nplus1;++h)for(let e=u_degree;e<u_nplus1;++e){let t=0,i=0,r=0,n=0,u=0;for(let _=h-v_degree;_<=h;++_,++u){let u=0;for(let s=e-u_degree;s<=e;++s,++u){let u=nurbs_weight(_,v_U[h],v_degree,v_U)*nurbs_weight(s,u_U[e],u_degree,u_U)*w_arr[u_nplus1*_+s];n+=u,t+=u*points[3*(u_nplus1*_+s)],i+=u*points[3*(u_nplus1*_+s)+1],r+=u*points[3*(u_nplus1*_+s)+2]}}if(n>0){let e=1/n;point(t*e,i*e,r*e)}}if(drawcp){stroke(50,255,50),scp_arr=[];for(e=0;e<points.length;e+=3)if(0!=pointsize_arr[e/3]){strokeWeight(20*pointsize_arr[e/3]),point(points[e],points[e+1],points[e+2]);let t=screenPosition(points[e],points[e+1],points[e+2]);scp_arr.push(t.x+width/2,t.y+height/2)}}drawed=!0}}function distance(e,t,i,r){let n=e-i,u=t-r;return n*n+u*u}function mouseMoved(){if(mouseX<=mousexmax&&mouseY>mouseymin){let t=0;for(var e=0;e<points.length;e+=3,++t)if(distance(scp_arr[2*t],scp_arr[2*t+1],mouseX,mouseY)<=100){if(on_point!=e/3){on_point=e/3;let t=document.getElementById("myPopup");t.style.left=mouseX-t.offsetWidth/2+"px",t.style.top=mouseY+"px",t.classList.add("show")}break}}}function mousePressed(){}function keyWatch(){keyIsDown(40)&&((szog1-=PI/18)<-PI/2&&(szog1=-PI/2),drawed=!1),keyIsDown(38)&&((szog1+=PI/18)>PI/2&&(szog1=PI/2),drawed=!1),keyIsDown(39)&&(szog2-=PI/18,drawed=!1),keyIsDown(37)&&(szog2+=PI/18,drawed=!1),keyIsDown(74)&&(sugar*=.9,drawed=!1),keyIsDown(70)&&(sugar*=1.1,drawed=!1)}